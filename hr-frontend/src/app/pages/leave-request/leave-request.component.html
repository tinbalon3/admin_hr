<div class="content">
  <h1 class="header-content">TẠO ĐƠN XIN NGHỈ PHÉP</h1>

  <div class="leave-request-container">
    <button mat-raised-button color="primary" class="create-button" (click)="openDialog()">
      Tạo đơn
    </button>
  </div>
  <div class="leave-request-container">
    <button mat-raised-button color="accent" *ngIf="hasSelected()" (click)="submitSelected()">
      <mat-icon>send</mat-icon> Gửi đơn
    </button>
  </div>
  <mat-card *ngIf="leaveRequests.length > 0" class="no-background">
    <table mat-table [dataSource]="leaveRequests" class="mat-elevation-z8">
  
      <!-- Username Column -->
      <ng-container matColumnDef="username">
        <th mat-header-cell *matHeaderCellDef> Tên nhân viên </th>
        <td mat-cell *matCellDef="let element"> {{ element.employee.full_name }} </td>
      </ng-container>
  
      <!-- Start Date Column -->
      <ng-container matColumnDef="startDate">
        <th mat-header-cell *matHeaderCellDef> Ngày bắt đầu </th>
        <td mat-cell *matCellDef="let element">
          <input matInput [(ngModel)]="element.leave_request.start_date" [matDatepicker]="startPicker" required>
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </td>
      </ng-container>
  
      <!-- End Date Column -->
      <ng-container matColumnDef="endDate">
        <th mat-header-cell *matHeaderCellDef> Ngày kết thúc </th>
        <td mat-cell *matCellDef="let element">
          <input matInput [(ngModel)]="element.leave_request.end_date" [matDatepicker]="endPicker" required>
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </td>
      </ng-container>
   
   <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef> Trạng thái </th>
    
      <td mat-cell *matCellDef="let element"> {{ element.leave_request.status }} </td>

  </ng-container>
      <!-- Note Column -->
      <ng-container matColumnDef="note">
        <th mat-header-cell *matHeaderCellDef> Ghi chú </th>
        <td mat-cell *matCellDef="let element">
          <input matInput [(ngModel)]="element.leave_request.notes" placeholder="Nhập ghi chú">
        </td>
      </ng-container>
  <!-- Type Column -->
  <ng-container matColumnDef="type">
    <th mat-header-cell *matHeaderCellDef> Loại nghỉ phép </th>
    <td mat-cell *matCellDef="let element">
      <mat-select [(ngModel)]="element.leave_type.id" 
                  (selectionChange)="onLeaveTypeChange(element, $event.value)" 
                  placeholder="Chọn loại nghỉ phép">
        <mat-option *ngFor="let type of leaveType" [value]="type.id">
          {{ type.type_name }}
        </mat-option>
      </mat-select>
    </td>
  </ng-container>
  

  
     <!-- Action Column - Gửi -->
<ng-container matColumnDef="action">
  <th mat-header-cell *matHeaderCellDef> Gửi </th>
  <td mat-cell *matCellDef="let element">
    <mat-checkbox [(ngModel)]="element.selected"></mat-checkbox>
  </td>
</ng-container>

<!-- Edit Column - Chỉnh sửa -->
<ng-container matColumnDef="edit">
  <th mat-header-cell *matHeaderCellDef> Chỉnh sửa </th>
  <td mat-cell *matCellDef="let element">
    <button mat-raised-button color="primary" (click)="updateLeaveRequest(element)">
      <mat-icon>edit</mat-icon> Cập nhật
    </button>
  </td>
</ng-container>

  
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let element; columns: displayedColumns;"></tr>
  
    </table>
  </mat-card>

  <mat-card *ngIf="leaveRequests.length === 0" class="no-data-card">
    <mat-icon>info</mat-icon>
    <p>Không có đơn nghỉ phép nào. Hãy nhấn "Tạo đơn" để bắt đầu.</p>
  </mat-card>
</div>
